---
title: 效能簡介-EF Core
description: 有效使用 Entity Framework Core 的效能指南
author: roji
ms.date: 12/1/2020
uid: core/miscellaneous/performance/index
ms.openlocfilehash: 14400d81ea3c93e2ebf40e8e585a457abf31478f
ms.sourcegitcommit: 4860d036ea0fb392c28799907bcc924c987d2d7b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/17/2020
ms.locfileid: "97657790"
---
# <a name="introduction-to-performance"></a>效能簡介

資料庫效能是廣泛且複雜的主題，橫跨整個元件堆疊：資料庫、網路、資料庫驅動程式，以及資料存取層（例如 EF Core）。 雖然高階層和 O/RMs （例如 EF Core 可大幅簡化應用程式開發和改進可維護性），但有時可能不透明，隱藏效能關鍵性的內部詳細資料，例如執行的 SQL。 本節將嘗試概述如何使用 EF Core 達到良好效能，以及如何避免可能會降低應用程式效能的常見陷阱。

## <a name="identify-bottlenecks-and-measure-measure-measure"></a>找出瓶頸和測量、測量、量值

一律具有效能，請務必不要在沒有顯示問題的資料的情況下進行優化。最棒的 Donald Knuth 一說，「過早的優化是所有惡意的根本」。 [效能診斷](xref:core/performance/performance-diagnosis)區段討論各種方法來瞭解應用程式在資料庫邏輯中花費時間的位置，以及如何找出特定的問題區域。 一旦識別出緩慢的查詢，就可以考慮解決問題：您的資料庫是否遺漏了索引？ 您應該嘗試其他查詢模式嗎？

一律將您的程式碼和可能的替代專案進行基準測試-效能診斷區段包含 BenchmarkDotNet 的範例基準測試，可供您用來作為自己基準測試的範本。 請勿假設一般，公用基準測試適用于您的特定使用案例;您資料表中的各種因素（例如資料庫延遲、查詢複雜度和實際資料量）可能會對最適合的解決方案造成深遠的影響。 例如，許多公用基準測試都是在理想的網路狀況下執行，其中資料庫的延遲幾乎為零，而且具有非常輕量的查詢，這幾乎不需要在資料庫端) 任何處理 (或磁片 i/o。 雖然這些很適合用來比較不同資料存取層的執行時間負荷，但是它們所顯示的差異通常會在實際的應用程式中證明是微不足道的，在此情況下，資料庫會對資料庫執行實際工作和延遲，是一項重要的效能因素。

## <a name="aspects-of-data-access-performance"></a>資料存取效能的各個層面

整體資料存取效能可細分為下列廣泛的類別：

* **純資料庫效能**。 使用關係資料庫時，EF 會將應用程式的 LINQ 查詢轉譯成資料庫所執行的 SQL 語句。這些 SQL 語句本身可以執行更多或更少的效率。 適當位置中的正確索引可能會讓 SQL 效能產生差異，或重寫您的 LINQ 查詢可能會讓 EF 產生更好的 SQL 查詢。
* **網路資料傳輸**。 與任何網路系統一樣，請務必限制在網路上來回傳輸的資料量。 這包括確保您只會傳送和載入您實際需要的資料，但也會在載入相關實體時避免所謂的「笛卡兒爆炸」效果。
* **網路往返**。 除了往返的資料量之外，網路往返的時間，是因為在資料庫中執行查詢所花費的時間，可在您的應用程式與資料庫之間來回傳送的時間小巫見大巫。 往返負荷嚴重取決於您的環境;您的資料庫伺服器越遠，延遲就越高，越大每次往返。 隨著雲端的出現，應用程式逐漸發現自己的資料庫，而「多對話」的應用程式執行過多的往返效能也會降低效能。 因此，請務必瞭解您的應用程式何時要與資料庫聯繫、其執行的往返次數，以及該數位是否可以最小化。
* **EF 執行時間額外負荷**。 最後，EF 本身會將一些執行時間額外負荷新增至資料庫作業： EF 需要從 (LINQ to SQL 編譯您的查詢，但通常只需進行一次) ，變更追蹤會增加一些額外負荷 (但可以停用) 等等。在實務上，在大部分情況下，實際應用程式的 EF 額外負荷可能會很微不足道，因為資料庫中的查詢執行時間和網路延遲會占總時間;但請務必瞭解您的選項是什麼，以及如何避免一些陷阱。

## <a name="know-whats-happening-under-the-hood"></a>知道幕後的進展

EF 可讓開發人員藉由產生 SQL、具體化結果和執行其他工作，專注于商務邏輯。 就像任何分層或抽象化一樣，它也可以隱藏幕後發生的情況，例如執行的實際 SQL 查詢。 效能不一定是每個應用程式的重要層面，但是在應用程式中，開發人員必須瞭解 EF 對它們執行的動作：檢查輸出的 SQL 查詢、遵循往返以確定未發生 N + 1 問題等等。

## <a name="cache-outside-the-database"></a>在資料庫外部快取

最後，與資料庫互動最有效率的方法是完全不要與其互動。 換句話說，如果資料庫存取在您的應用程式中顯示為效能瓶頸，則在資料庫之外快取某些結果可能是值得的，以便將要求降至最低。 雖然快取會增加複雜度，但它是任何可擴充應用程式中特別重要的部分：雖然應用層可以藉由新增額外的伺服器來處理增加的負載，藉此輕鬆調整，而調整資料庫層級通常會更複雜。
