---
title: 資料庫函數-EF Core
description: EF Core 查詢轉譯中支援的資料庫函數資訊
author: smitpatel
ms.date: 11/10/2020
uid: core/querying/database-functions
ms.openlocfilehash: 34ced2a602168f6ed84763c046ef581cb87026e8
ms.sourcegitcommit: 42bbf7f68e92c364c5fff63092d3eb02229f568d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/11/2020
ms.locfileid: "94503793"
---
# <a name="database-functions"></a><span data-ttu-id="bc4e7-103">資料庫函數</span><span class="sxs-lookup"><span data-stu-id="bc4e7-103">Database Functions</span></span>

<span data-ttu-id="bc4e7-104">資料庫函式是 [c # 方法](/dotnet/csharp/programming-guide/classes-and-structs/methods)的相等資料庫。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-104">Database functions are the database equivalent of [C# methods](/dotnet/csharp/programming-guide/classes-and-structs/methods).</span></span> <span data-ttu-id="bc4e7-105">您可以使用零個或多個參數叫用資料庫函式，它會根據參數值來計算結果。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-105">A database function can be invoked with zero or more parameters and it computes the result based on the parameter values.</span></span> <span data-ttu-id="bc4e7-106">大部分使用 SQL 進行查詢的資料庫都支援資料庫函數。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-106">Most databases, which use SQL for querying have support for database functions.</span></span> <span data-ttu-id="bc4e7-107">因此，EF Core 查詢轉譯產生的 SQL 也允許叫用資料庫函數。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-107">So SQL generated by EF Core query translation also allows invoking database functions.</span></span> <span data-ttu-id="bc4e7-108">C # 方法不需要嚴格地轉譯成 EF Core 中的資料庫函式。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-108">C# methods don't have to translate strictly to database functions in EF Core.</span></span>

- <span data-ttu-id="bc4e7-109">C # 方法可能沒有相等的資料庫函數。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-109">A C# method may not have an equivalent database function.</span></span>
  - <span data-ttu-id="bc4e7-110"><xref:System.String.IsNullOrEmpty%2A?displayProperty=nameWithType> 方法會轉譯為 null 檢查，並使用資料庫中的空字串（而不是函式）進行比較。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-110"><xref:System.String.IsNullOrEmpty%2A?displayProperty=nameWithType> method translates to a null check and a comparison with an empty string in the database rather than a function.</span></span>
  - <span data-ttu-id="bc4e7-111"><xref:System.String.Equals(System.String,System.StringComparison)?displayProperty=nameWithType> 方法沒有相等的資料庫，因為在資料庫中無法輕鬆表示或模仿字串比較。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-111"><xref:System.String.Equals(System.String,System.StringComparison)?displayProperty=nameWithType> method doesn't have database equivalent since string comparison can't be represented or mimicked easily in a database.</span></span>
- <span data-ttu-id="bc4e7-112">資料庫函式可能沒有相等的 c # 方法。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-112">A database function may not have an equivalent C# method.</span></span> <span data-ttu-id="bc4e7-113">`??`C # 中沒有任何方法的運算子會轉譯為 `COALESCE` 資料庫中的函數。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-113">The `??` operator in C#, which doesn't have any method, translates to the `COALESCE` function in the database.</span></span>

## <a name="types-of-database-functions"></a><span data-ttu-id="bc4e7-114">資料庫函式的類型</span><span class="sxs-lookup"><span data-stu-id="bc4e7-114">Types of database functions</span></span>

<span data-ttu-id="bc4e7-115">EF Core SQL 世代支援可在資料庫中使用的函數子集。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-115">EF Core SQL generation supports a subset of functions that can be used in databases.</span></span> <span data-ttu-id="bc4e7-116">這項限制是因為能夠以 LINQ 表示指定資料庫函式的查詢。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-116">This limitation comes from the ability to represent a query in LINQ for the given database function.</span></span> <span data-ttu-id="bc4e7-117">此外，每個資料庫都有不同的資料庫函式支援，所以 EF Core 提供一個共同的子集。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-117">Further, each database has varying support of database functions, so EF Core provides a common subset.</span></span> <span data-ttu-id="bc4e7-118">資料庫提供者可自由擴充 EF Core SQL 產生，以支援更多的模式。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-118">A database provider is free to extend EF Core SQL generation to support more patterns.</span></span> <span data-ttu-id="bc4e7-119">以下是 EF Core 支援和唯一識別的資料庫函數類型。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-119">Following are the types of database functions EF Core supports and uniquely identifies.</span></span> <span data-ttu-id="bc4e7-120">這些條款也有助於瞭解 EF Core 提供者內建的翻譯。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-120">These terms also help in understanding what translations come built in with EF Core providers.</span></span>

### <a name="built-in-vs-user-defined-functions"></a><span data-ttu-id="bc4e7-121">內建 vs 使用者定義函數</span><span class="sxs-lookup"><span data-stu-id="bc4e7-121">Built-in vs user-defined functions</span></span>

<span data-ttu-id="bc4e7-122">內建函數隨附資料庫預先定義，但使用者定義的函數是由資料庫中的使用者明確定義。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-122">Built-in functions come with database predefined, but user-defined functions are explicitly defined by the user in the database.</span></span> <span data-ttu-id="bc4e7-123">當 EF Core 將查詢轉譯為使用資料庫函式時，它會使用內建函數來確定資料庫上的函數一律可供使用。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-123">When EF Core translates queries to use database functions, it uses built-in functions to make sure that the function is always available on the database.</span></span> <span data-ttu-id="bc4e7-124">在某些資料庫中，必須區分內建函數，才能正確產生 SQL。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-124">The distinction of built-in functions is necessary in some databases to generate SQL correctly.</span></span> <span data-ttu-id="bc4e7-125">例如 SqlServer 需要使用架構限定名稱來叫用每個使用者定義函數。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-125">For example SqlServer requires that every user-defined function is invoked with a schema-qualified name.</span></span> <span data-ttu-id="bc4e7-126">但是 SqlServer 中的內建函數沒有架構。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-126">But built-in functions in SqlServer don't have a schema.</span></span> <span data-ttu-id="bc4e7-127">于 postgresql 會在架構中定義內建函數， `public` 但是可以使用架構限定名稱來叫用。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-127">PostgreSQL defines built-in function in the `public` schema but they can be invoked with schema-qualified names.</span></span>

### <a name="aggregate-vs-scalar-vs-table-valued-functions"></a><span data-ttu-id="bc4e7-128">匯總 vs 純量和資料表值函數</span><span class="sxs-lookup"><span data-stu-id="bc4e7-128">Aggregate vs scalar vs table-valued functions</span></span>

- <span data-ttu-id="bc4e7-129">純量函數會採用純量值（例如整數或字串）作為參數，並傳回純量值作為結果。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-129">Scalar functions take scalar values - like integers or strings - as parameters and return a scalar value as the result.</span></span> <span data-ttu-id="bc4e7-130">純量函數可用於 SQL 中可傳遞純量值的任何位置。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-130">Scalar functions can be used anywhere in SQL where a scalar value can be passed.</span></span>
- <span data-ttu-id="bc4e7-131">彙總函式會以純量值的資料流程作為參數，並傳回純量值作為結果。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-131">Aggregate functions take a stream of scalar values as parameters and return a scalar value as the result.</span></span> <span data-ttu-id="bc4e7-132">彙總函式會套用至整個查詢結果集或套用運算子所產生的值群組 `GROUP BY` 。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-132">Aggregate functions are applied on the whole query result set or on a group of values generated by applying `GROUP BY` operator.</span></span>
- <span data-ttu-id="bc4e7-133">資料表值函式會採用純量值做為參數 (s) ，並傳回資料列的資料流程作為結果。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-133">Table-valued functions take scalar values as parameter(s) and return a stream of rows as the result.</span></span> <span data-ttu-id="bc4e7-134">資料表值函式會當做資料表來源 in 子句來使用 `FROM` 。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-134">Table-valued functions are used as a table source in `FROM` clause.</span></span>

### <a name="niladic-functions"></a><span data-ttu-id="bc4e7-135">Niladic 函式</span><span class="sxs-lookup"><span data-stu-id="bc4e7-135">Niladic functions</span></span>

<span data-ttu-id="bc4e7-136">Niladic 函式是特殊的資料庫函式，沒有任何參數，且必須在沒有括弧的情況下叫用。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-136">Niladic functions are special database functions that don't have any parameters and must be invoked without parenthesis.</span></span> <span data-ttu-id="bc4e7-137">它們類似于 c # 中實例上的屬性/欄位存取。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-137">They're similar to property/field access on an instance in C#.</span></span> <span data-ttu-id="bc4e7-138">Niladic 函式與參數不相同的函式不同，因為後者需要空的括弧。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-138">Niladic functions differ from parameter-less functions as the latter require empty parenthesis.</span></span> <span data-ttu-id="bc4e7-139">如果資料庫函式沒有特殊的名稱，則一律需要括弧。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-139">There's no special name for database functions that requires parenthesis always.</span></span> <span data-ttu-id="bc4e7-140">以參數計數為基礎的另一個資料庫函數子集是 variadic 函式。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-140">Another subset of database functions based on parameter count is variadic functions.</span></span> <span data-ttu-id="bc4e7-141">叫用時，Variadic 函式可採用不同數目的參數。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-141">Variadic functions can take varying number of parameters when invoked.</span></span>

## <a name="database-function-mappings-in-ef-core"></a><span data-ttu-id="bc4e7-142">EF Core 中的資料庫函數對應</span><span class="sxs-lookup"><span data-stu-id="bc4e7-142">Database function mappings in EF Core</span></span>

<span data-ttu-id="bc4e7-143">EF Core 支援三種不同的 c # 函式和資料庫函數之間的對應方式。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-143">EF Core supports three different ways of mapping between C# functions and database functions.</span></span>

### <a name="built-in-function-mapping"></a><span data-ttu-id="bc4e7-144">內建函數對應</span><span class="sxs-lookup"><span data-stu-id="bc4e7-144">Built-in function mapping</span></span>

<span data-ttu-id="bc4e7-145">根據預設，EF Core 提供者會針對基本類型上的各種內建函數提供對應。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-145">By default EF Core providers provide mappings for various built-in functions over primitive types.</span></span> <span data-ttu-id="bc4e7-146">例如， <xref:System.String.ToLower?displayProperty=nameWithType> `LOWER` 在 SqlServer 中會轉譯為。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-146">For example, <xref:System.String.ToLower?displayProperty=nameWithType> translates to `LOWER` in SqlServer.</span></span> <span data-ttu-id="bc4e7-147">這項功能可讓使用者順暢地以 LINQ 撰寫查詢。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-147">This functionality allows users to write queries in LINQ seamlessly.</span></span> <span data-ttu-id="bc4e7-148">我們通常會在資料庫中提供轉譯，以提供與 c # 函式在用戶端上提供的結果相同的結果。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-148">We usually provide a translation in the database that gives the same result as what the C# function provides on the client side.</span></span> <span data-ttu-id="bc4e7-149">有時候，若要達到此目的，實際的翻譯可能會比資料庫函式更複雜一點。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-149">Sometimes, to achieve that, the actual translation could be something more complicated than a database function.</span></span> <span data-ttu-id="bc4e7-150">在某些案例中，我們也會提供最適當的轉譯，而不是比對 c # 語法。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-150">In some scenarios, we also provide the most appropriate translation rather than matching C# semantics.</span></span> <span data-ttu-id="bc4e7-151">相同的功能也會用來提供某些 c # 成員存取的一般翻譯。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-151">The same feature is also used to provide common translations for some of the C# member accesses.</span></span> <span data-ttu-id="bc4e7-152">例如， <xref:System.String.Length?displayProperty=nameWithType> `LEN` 在 SqlServer 中會轉譯為。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-152">For example, <xref:System.String.Length?displayProperty=nameWithType> translates to `LEN` in SqlServer.</span></span> <span data-ttu-id="bc4e7-153">除了提供者之外，外掛程式寫入器也可以新增額外的翻譯。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-153">Apart from providers, plugin writers can also add additional translations.</span></span> <span data-ttu-id="bc4e7-154">當外掛程式將更多類型的支援做為基本型別，且想要對其轉譯方法時，此擴充性相當實用。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-154">This extensibility is useful when plugins add support for more types as primitive types and want to translate methods over them.</span></span>

### <a name="effunctions-mapping"></a><span data-ttu-id="bc4e7-155">英 孚。函數對應</span><span class="sxs-lookup"><span data-stu-id="bc4e7-155">EF.Functions mapping</span></span>

<span data-ttu-id="bc4e7-156">由於並非所有資料庫函式都有對等的 c # 函式，EF Core 提供者具有特殊的 c # 方法，可叫用特定的資料庫</span><span class="sxs-lookup"><span data-stu-id="bc4e7-156">Since not all database functions have equivalent C# functions, EF Core providers have special C# methods to invoke certain database functions.</span></span> <span data-ttu-id="bc4e7-157">這些方法會定義為 `EF.Functions` 要在 LINQ 查詢中使用的擴充方法。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-157">These methods are defined as extension methods over `EF.Functions` to be used in LINQ queries.</span></span> <span data-ttu-id="bc4e7-158">這些方法是提供者專屬的，因為它們與特定的資料庫函式密切相關。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-158">These methods are provider-specific as they're closely tied with particular database functions.</span></span> <span data-ttu-id="bc4e7-159">因此，適用于一個提供者的方法，可能不會用於任何其他提供者。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-159">So a method that works for one provider will likely not work for any other provider.</span></span> <span data-ttu-id="bc4e7-160">此外，因為這些方法的目的是要在已轉譯的查詢中叫用資料庫函式，所以嘗試在用戶端上評估這些函數會導致例外狀況。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-160">Further, since the intention of these methods is to invoke a database function in the translated query, trying to evaluate them on the client results in an exception.</span></span>

### <a name="user-defined-function-mapping"></a><span data-ttu-id="bc4e7-161">使用者定義函數對應</span><span class="sxs-lookup"><span data-stu-id="bc4e7-161">User-defined function mapping</span></span>

<span data-ttu-id="bc4e7-162">除了 EF Core 提供者所提供的對應之外，使用者也可以定義自訂對應。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-162">Apart from mappings provided by EF Core providers, users can also define custom mapping.</span></span> <span data-ttu-id="bc4e7-163">使用者定義的對應會根據使用者需求來擴充查詢轉譯。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-163">A user-defined mapping extends the query translation according to the user needs.</span></span> <span data-ttu-id="bc4e7-164">當資料庫中有使用者定義的函式時，如果使用者想要從其 LINQ 查詢叫用，這項功能就很有用。</span><span class="sxs-lookup"><span data-stu-id="bc4e7-164">This functionality is useful when there are user-defined functions in the database, which the user wants to invoke from their LINQ query.</span></span>

## <a name="see-also"></a><span data-ttu-id="bc4e7-165">另請參閱</span><span class="sxs-lookup"><span data-stu-id="bc4e7-165">See also</span></span>

- [<span data-ttu-id="bc4e7-166">SqlServer 內建函數對應</span><span class="sxs-lookup"><span data-stu-id="bc4e7-166">SqlServer built-in function mappings</span></span>](xref:core/providers/sql-server/functions)
- [<span data-ttu-id="bc4e7-167">Sqlite 內建函數對應</span><span class="sxs-lookup"><span data-stu-id="bc4e7-167">Sqlite built-in function mappings</span></span>](xref:core/providers/sqlite/functions)
- [<span data-ttu-id="bc4e7-168">Cosmos 內建函數對應</span><span class="sxs-lookup"><span data-stu-id="bc4e7-168">Cosmos built-in function mappings</span></span>](xref:core/providers/cosmos/functions)
