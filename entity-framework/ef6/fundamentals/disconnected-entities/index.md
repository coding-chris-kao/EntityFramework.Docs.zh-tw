---
title: 使用已中斷連線的實體 - EF6
description: 使用 Entity Framework 6 中已中斷連線的實體
author: divega
ms.date: 10/23/2016
uid: ef6/fundamentals/disconnected-entities/index
ms.openlocfilehash: 5e9f0ffbf0150500b0162ce7ead83a87a29b641a
ms.sourcegitcommit: abda0872f86eefeca191a9a11bfca976bc14468b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/14/2020
ms.locfileid: "90072755"
---
# <a name="working-with-disconnected-entities"></a><span data-ttu-id="e04b3-103">使用已中斷連線的實體</span><span class="sxs-lookup"><span data-stu-id="e04b3-103">Working with disconnected entities</span></span>

<span data-ttu-id="e04b3-104">在 Entity Framework 架構應用程式中，內容類別負責偵測套用至追蹤實體的變更。</span><span class="sxs-lookup"><span data-stu-id="e04b3-104">In an Entity Framework-based application, a context class is responsible for detecting changes applied to tracked entities.</span></span> <span data-ttu-id="e04b3-105">呼叫 SaveChanges 方法會將內容所追蹤的變更保存到資料庫。</span><span class="sxs-lookup"><span data-stu-id="e04b3-105">Calling the SaveChanges method persists the changes tracked by the context to the database.</span></span> <span data-ttu-id="e04b3-106">使用多層式架構 (N-Tier) 應用程式時，實體物件通常會在中斷與內容的連線時進行修改；因此您必須決定如何追蹤變更，以及如何將這些變更回報至內容。</span><span class="sxs-lookup"><span data-stu-id="e04b3-106">When working with n-tier applications, entity objects are usually modified while disconnected from the context, and you must decide how to track changes and report those changes back to the context.</span></span> <span data-ttu-id="e04b3-107">本主題討論搭配使用 Entity Framework 與已中斷連線的實體時可用的不同選項。</span><span class="sxs-lookup"><span data-stu-id="e04b3-107">This topic discusses different options that are available when using Entity Framework with disconnected entities.</span></span>

## <a name="web-service-frameworks"></a><span data-ttu-id="e04b3-108">Web 服務架構</span><span class="sxs-lookup"><span data-stu-id="e04b3-108">Web service frameworks</span></span>

<span data-ttu-id="e04b3-109">Web 服務技術通常支援一些模式，而這些模式可用來保存已中斷連線之個別物件的變更。</span><span class="sxs-lookup"><span data-stu-id="e04b3-109">Web services technologies typically support patterns that can be used to persist changes on individual disconnected objects.</span></span> <span data-ttu-id="e04b3-110">例如，ASP.NET Web API 可讓您選寫控制器動作的程式碼，其中包含 EF 的呼叫，用來保存對資料庫上的物件所做的變更。</span><span class="sxs-lookup"><span data-stu-id="e04b3-110">For example, ASP.NET Web API allows you to code controller actions that can include calls to EF to persist changes made to an object on a database.</span></span> <span data-ttu-id="e04b3-111">事實上，Visual Studio 中的 Web API 工具可讓您輕鬆地從 Entity Framework 6 模型中 Scaffold Web API 控制器。</span><span class="sxs-lookup"><span data-stu-id="e04b3-111">In fact, the Web API tooling in Visual Studio makes it easy to scaffold a Web API controller from your Entity Framework 6 model.</span></span> <span data-ttu-id="e04b3-112">如需詳細資訊，請參閱[搭配使用 Web API 與 Entity Framework 6](/aspnet/web-api/overview/data/using-web-api-with-entity-framework/)。</span><span class="sxs-lookup"><span data-stu-id="e04b3-112">For more information, see [using Web API with Entity Framework 6](/aspnet/web-api/overview/data/using-web-api-with-entity-framework/).</span></span>

<span data-ttu-id="e04b3-113">在過去，已有數項其他的 Web 服務技術提供與 Entity Framework 的整合，例如 [WCF Data Services](/dotnet/framework/data/wcf/create-a-data-service-using-an-adonet-ef-data-wcf) 和 [RIA Services](/previous-versions/dotnet/wcf-ria/ee707344(v=vs.91))。</span><span class="sxs-lookup"><span data-stu-id="e04b3-113">Historically, there have been several other Web services technologies that offered integration with Entity Framework, like [WCF Data Services](/dotnet/framework/data/wcf/create-a-data-service-using-an-adonet-ef-data-wcf) and [RIA Services](/previous-versions/dotnet/wcf-ria/ee707344(v=vs.91)).</span></span>

## <a name="low-level-ef-apis"></a><span data-ttu-id="e04b3-114">低層級 EF API</span><span class="sxs-lookup"><span data-stu-id="e04b3-114">Low-level EF APIs</span></span>

<span data-ttu-id="e04b3-115">如果您不想要使用現有的多層式架構 (N-Tier) 解決方案，或者想要自訂 Web API 服務中控制器動作所發生的狀況，Entity Framework 提供的 API 可讓您套用在中斷連線的層上所做的變更。</span><span class="sxs-lookup"><span data-stu-id="e04b3-115">If you don't want to use an existing n-tier solution, or if you want to customize what happens inside a controller action in a Web API services, Entity Framework provides APIs that allow you to apply changes made on a disconnected tier.</span></span> <span data-ttu-id="e04b3-116">如需詳細資訊，請參閱[新增、附加和實體狀態](xref:ef6/saving/change-tracking/entity-state)。</span><span class="sxs-lookup"><span data-stu-id="e04b3-116">For more information, see [Add, Attach, and entity state](xref:ef6/saving/change-tracking/entity-state).</span></span>  

## <a name="self-tracking-entities"></a><span data-ttu-id="e04b3-117">自我追蹤實體</span><span class="sxs-lookup"><span data-stu-id="e04b3-117">Self-Tracking Entities</span></span>  

<span data-ttu-id="e04b3-118">在中斷與 EF 內容的連線時追蹤任意實體圖形的變更是一道難題。</span><span class="sxs-lookup"><span data-stu-id="e04b3-118">Tracking changes on arbitrary graphs of entities while disconnected from the EF context is a hard problem.</span></span> <span data-ttu-id="e04b3-119">嘗試解決此問題的其中一個方法是自我追蹤實體的程式碼產生範本。</span><span class="sxs-lookup"><span data-stu-id="e04b3-119">One of the attempts to solve it was the Self-Tracking Entities code generation template.</span></span> <span data-ttu-id="e04b3-120">此範本會產生實體類別，其中包含的邏輯可用來追蹤已中斷連線層所做的變更，以作為實體本身的狀態。</span><span class="sxs-lookup"><span data-stu-id="e04b3-120">This template generates entity classes that contain logic to track changes made on a disconnected tier as state in the entities themselves.</span></span> <span data-ttu-id="e04b3-121">還會產生一組擴充方法，將這些變更套用到內容。</span><span class="sxs-lookup"><span data-stu-id="e04b3-121">A set of extension methods is also generated to apply those changes to a context.</span></span>

<span data-ttu-id="e04b3-122">這個範本可與使用 EF 設計工具建立的模型搭配使用，但無法與 Code First 模型搭配使用。</span><span class="sxs-lookup"><span data-stu-id="e04b3-122">This template can be used with models created using the EF Designer, but can not be used with Code First models.</span></span> <span data-ttu-id="e04b3-123">如需詳細資訊，請參閱[自我追蹤實體](xref:ef6/fundamentals/disconnected-entities/self-tracking-entities/index)。</span><span class="sxs-lookup"><span data-stu-id="e04b3-123">For more information, see [Self-Tracking Entities](xref:ef6/fundamentals/disconnected-entities/self-tracking-entities/index).</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="e04b3-124">我們不再建議使用自我追蹤實體範本。</span><span class="sxs-lookup"><span data-stu-id="e04b3-124">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="e04b3-125">繼續提供該範本只是為了支援現有應用程式。</span><span class="sxs-lookup"><span data-stu-id="e04b3-125">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="e04b3-126">如果您的應用程式需要使用已中斷連線的實體圖形，請考慮使用 [Trackable Entities](https://trackableentities.github.io/) (可追蹤的實體) 之類的其他替代項目，這是一項類似於自我追蹤實體的技術，可由社群更積極地進行開發或使用低層級變更追蹤 API 來撰寫自訂程式碼。</span><span class="sxs-lookup"><span data-stu-id="e04b3-126">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](https://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>
